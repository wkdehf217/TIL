# JWT, 인증 / 인가, AccessToken / RefreshToken
<br/>

## 클라리언트 측 렌더링(CSR) 과 API

JWT를 살펴보기에 앞서 CSR과 API부터 이해해보자.

API 서버는 데이터를 처리하고 제공함으로써 백엔드 역할을 수행하며, 
CSR은 이러한 데이터를 사용하여 사용자 인터페이스를 동적으로 렌더링하여 프론트엔드를 담당한다.

여기서 JWT는 클라이언트와 서버 간의 인증 및 정보 교환을 위한 안전한 토큰으로 사용된다.

<br/>

## 그래서 JWT란?

간단하게 말하면 Json을 사용하는 Web Token 이다.

기존에는 세션 토큰이나 쿠키를 사용하여 사용자를 인증하고 상태를 유지했다.

그러나 이러한 방식은 

1. 서버가 1대인 경우 : 서버의 세션 1이 Client의 로그인 정보를 소유
2. 서버가 2대인 경우 : 세션마다 다른 Client의 로그인 정보를 소유

과 같은 문제가 있다.

<br/>

이와 같은 문제를 해결하기 위해서는 3가지의 방법이 있는데,

1. Sticky Session : Client마다 요청 Server를 고정
2. 세션 저장소를 생성하여 모든 세션을 저장
3. JWT : 로그인 정보를 Server에 저장하지 않고, Client에 로그인 정보를 JWT로 암호화하여 저장. 단 Secret Key를 가지고 있어야 함.

<br/>

1,2번은 비효율적이라서 JWT를 사용하며, 다음과 같은 방식이다.

![image](https://github.com/wkdehf217/TIL/assets/45251507/9cc8942d-1813-4d08-adde-3eabd390137e)

![image](https://github.com/wkdehf217/TIL/assets/45251507/ed5f6135-264c-45c1-94a2-4ea6d0264147)

<br/>

JWT의 단점은 

1. 구현의 복잡도 증가
2. JWT가 커질수록 네트워크 비용 증가
3. 기 생성된 JWT 일부 만료 불가(대신 만료 기한을 줄 수 있음)
4. 보안 문제

정도로 정리된다.

<br/>

## JWT와 인증/인가의 관계는?

- Authentiaction( 인증 ) : 실제 유저인지 확인 ( 로그인 )
- Authorization( 인가 ) : 유저가 접근 가능한지 허가 확인 ( 회원/비회원 )

JWT는 결국 인증 및 인가 시스템에서 사용되는 보안 토큰의 한 형태이다.

따라서 사용자가 인증되면 JWT가 발급되고, 이 JWT는 사용자의 인가 정보를 포함하여 사용자가 특성 리소스에 대한 엑세스를 요청할 때 사용된다 라고 이해할 수 있다.

<br/>

## AccessToken, RefreshToken

인증에 사용되는 토큰을 AccessToken 이라 한다. **JWT는 이러한 토큰을 구현하는 방법 중 하나이다.**

AccessToken을 활용한 인증시나리오는 보통 다음과 같다. 

- AccessToken은 인증된 사용자가 서비스 또는 API에 접근할 때 사용되는 토큰이다. 일반적으로 사용자가 로그인한 후에 발급된다.
- 특정 사용자를 나타내는 정보와 사용자가 특정 리소스 또는 기능에 대한 액세스 권한을 나타내는 클레임(claims)을 포함한다.
- 보통 짧은 유효기간을 가지며, 만료되면 다시 발급해야 한다.

짧은 유효기간을 가지는 이유는, 토큰이 다른 사용자에게 노출되었을 경우가 있기 때문이다.

그래서 만료된 Access Token을 발급받을 수 있는 Refresh Token을 생성해주어서 필요할 때 다시 발급받을 수 있게 한다.

RefreshToken은 사용자가 로그인한 후에 발급되며, 보통 AccessToken과 함께 발급된다.

그런데 RefreshToken 마저 노출된다면?

RefreshToken이 노출되었다는 알림을 사용자에게 준다고 해도, 이미 그 토큰을 사용해서 새로운 AccessToken을 부여받고, 악의적인 행동을 막을 수 없기 때문에 이러한 한계를 가진다.
